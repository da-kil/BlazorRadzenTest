@using BlazorRadzenTest.Client.Models
@using Radzen
@using Radzen.Blazor

<RadzenCard Class="career-planning-step">
    <RadzenText TextStyle="TextStyle.H4" Class="text-primary mb-3">
        <RadzenIcon Icon="psychology" Class="me-2" />
        2024 Career Development & Planning
    </RadzenText>
    
    <RadzenText TextStyle="TextStyle.Body1" Class="mb-4">
        This section focuses on your professional development. Consider which skills or career steps you want to pursue in the future. 
        Discuss your long-term goals and the support you need to achieve them.
    </RadzenText>

    <div class="planning-sections">
        <RadzenCard Class="planning-card mb-4 p-3 border-start border-primary border-3">
            <RadzenText TextStyle="TextStyle.Subtitle1" Class="fw-bold text-primary mb-3">
                <RadzenIcon Icon="timeline" Class="me-2" />
                Career Ambitions
            </RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Class="text-muted mb-2">
                Where do you see yourself long-term in your professional career? Are there specific career paths or positions you're striving for?
            </RadzenText>
            <RadzenTextArea @bind-Value="@CareerPlans.CareerAmbitions"
                          @bind-Value:after="UpdateCareerPlans"
                          Placeholder="Describe your long-term career aspirations, desired roles, or career progression..."
                          Rows="4"
                          Class="w-100" />
        </RadzenCard>

        <RadzenCard Class="planning-card mb-4 p-3 border-start border-info border-3">
            <RadzenText TextStyle="TextStyle.Subtitle1" Class="fw-bold text-info mb-3">
                <RadzenIcon Icon="school" Class="me-2" />
                Development Needs
            </RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Class="text-muted mb-2">
                What further development or improvement do you need to achieve your professional goals? What support do you need from your supervisor?
            </RadzenText>
            <RadzenTextArea @bind-Value="@CareerPlans.DevelopmentNeeds"
                          @bind-Value:after="UpdateCareerPlans"
                          Placeholder="Identify skills to develop, training needs, mentoring, or other support required..."
                          Rows="4"
                          Class="w-100" />
        </RadzenCard>

        <RadzenCard Class="planning-card mb-4 p-3 border-start border-warning border-3">
            <RadzenText TextStyle="TextStyle.Subtitle1" Class="fw-bold text-warning mb-3">
                <RadzenIcon Icon="warning" Class="me-2" />
                Challenges & Obstacles
            </RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Class="text-muted mb-2">
                What obstacles or challenges might arise in achieving your career goals, and how could they be overcome?
            </RadzenText>
            <RadzenTextArea @bind-Value="@CareerPlans.ChallengesAndObstacles"
                          @bind-Value:after="UpdateCareerPlans"
                          Placeholder="Describe potential barriers and your strategies to overcome them..."
                          Rows="4"
                          Class="w-100" />
        </RadzenCard>

        <RadzenCard Class="planning-card mb-4 p-3 border-start border-success border-3">
            <RadzenText TextStyle="TextStyle.Subtitle1" Class="fw-bold text-success mb-3">
                <RadzenIcon Icon="star" Class="me-2" />
                Personal Strengths & Development Areas
            </RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Class="text-muted mb-2">
                What personal strengths would you like to further develop, and in which areas do you see development potential?
            </RadzenText>
            <RadzenTextArea @bind-Value="@CareerPlans.StrengthsAndDevelopmentAreas"
                          @bind-Value:after="UpdateCareerPlans"
                          Placeholder="Reflect on your key strengths and areas where you want to grow..."
                          Rows="4"
                          Class="w-100" />
        </RadzenCard>

        <RadzenCard Class="planning-card mb-4 p-3 border-start border-secondary border-3">
            <RadzenText TextStyle="TextStyle.Subtitle1" Class="fw-bold text-secondary mb-3">
                <RadzenIcon Icon="feedback" Class="me-2" />
                Supervisor Feedback & Support Opportunities
            </RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Class="text-muted mb-2">
                What specific feedback would you like from your supervisor, and what support opportunities would help your development?
            </RadzenText>
            <RadzenTextArea @bind-Value="@CareerPlans.SupervisorFeedback"
                          @bind-Value:after="UpdateCareerPlans"
                          Placeholder="Specify the type of feedback and support you're seeking from your supervisor..."
                          Rows="4"
                          Class="w-100" />
        </RadzenCard>
    </div>

    <div class="completion-status mt-4">
        <RadzenText TextStyle="TextStyle.Body2" Class="text-muted">
            Completion Progress: @completedSections out of 5 sections completed
        </RadzenText>
        <RadzenProgressBar Value="@(completedSections * 20)" Max="100" Class="mt-2" />
    </div>
</RadzenCard>

@code {
    [Parameter] public CareerPlan CareerPlans { get; set; } = new();
    [Parameter] public EventCallback<CareerPlan> CareerPlansChanged { get; set; }
    
    [Parameter] public bool CanProceed { get; set; } = false;
    [Parameter] public EventCallback<bool> CanProceedChanged { get; set; }

    private int completedSections => 
        (string.IsNullOrWhiteSpace(CareerPlans.CareerAmbitions) ? 0 : 1) +
        (string.IsNullOrWhiteSpace(CareerPlans.DevelopmentNeeds) ? 0 : 1) +
        (string.IsNullOrWhiteSpace(CareerPlans.ChallengesAndObstacles) ? 0 : 1) +
        (string.IsNullOrWhiteSpace(CareerPlans.StrengthsAndDevelopmentAreas) ? 0 : 1) +
        (string.IsNullOrWhiteSpace(CareerPlans.SupervisorFeedback) ? 0 : 1);

    protected override async Task OnInitializedAsync()
    {
        await UpdateValidation();
    }

    private async Task UpdateCareerPlans()
    {
        await CareerPlansChanged.InvokeAsync(CareerPlans);
        await UpdateValidation();
    }

    private async Task UpdateValidation()
    {
        // Require at least 3 out of 5 sections to be completed
        bool canProceed = completedSections >= 3;
        await CanProceedChanged.InvokeAsync(canProceed);
    }

}