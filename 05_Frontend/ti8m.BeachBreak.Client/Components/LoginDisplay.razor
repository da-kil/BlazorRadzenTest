@using Microsoft.AspNetCore.Components.Authorization
@implements IDisposable
@inject NavigationManager Navigation

<div class="login-display">
    <AuthorizeView>
        <Authorized>
            <form action="authentication/logout" method="post">
                <AntiforgeryToken />
                <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                <button type="submit" class="logout-btn">
                    Logout @context.User.Identity?.Name
                </button>
            </form>
        </Authorized>
        <NotAuthorized>
            <a class="login-link" href="authentication/login">
                Login
            </a>
        </NotAuthorized>
    </AuthorizeView>
</div>

<style>
    .login-display {
        display: flex;
        align-items: center;
    }

    .logout-btn,
    .login-link {
        background: transparent;
        border: none;
        color: var(--text-white);
        padding: var(--spacing-sm) var(--spacing-md);
        cursor: pointer;
        font-size: var(--font-size-base);
        font-weight: var(--font-weight-regular);
        text-decoration: none;
        transition: var(--transition-fast);
        white-space: nowrap;
    }

    .logout-btn:hover,
    .login-link:hover {
        color: var(--text-white-75);
    }
</style>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = Navigation.ToBaseRelativePath(Navigation.Uri);
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = Navigation.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}