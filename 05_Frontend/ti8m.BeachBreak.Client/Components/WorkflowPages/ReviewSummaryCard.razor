@using Radzen
@using Radzen.Blazor
@using ti8m.BeachBreak.Client.Models
@using ti8m.BeachBreak.Client.Models.DTOs
@using ti8m.BeachBreak.Client.Components.Shared
@using ti8m.BeachBreak.Client.Extensions
@inherits OptimizedTranslatableComponentBase

<div class="review-summary-card">
    <RadzenCard Class="h-100">
        <RadzenStack Gap="1rem">
            <!-- Header -->
            <div class="card-header">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenIcon Icon="summarize" Style="color: var(--primary-color); font-size: 1.25rem;" />
                    <RadzenText TextStyle="TextStyle.H6" Class="mb-0">
                        @T("sections.review-summary")
                    </RadzenText>
                </RadzenStack>
            </div>

            <!-- Questionnaire Information -->
            <div class="questionnaire-info">
                <RadzenText TextStyle="TextStyle.Subtitle2" Class="fw-bold mb-2">
                    @Template.GetLocalizedNameWithFallback(CurrentLanguage)
                </RadzenText>

                @if (!string.IsNullOrWhiteSpace(Template.GetLocalizedDescriptionWithFallback(CurrentLanguage)))
                {
                    <RadzenText TextStyle="TextStyle.Body2" Class="text-muted mb-3">
                        @Template.GetLocalizedDescriptionWithFallback(CurrentLanguage)
                    </RadzenText>
                }

                <!-- Assignment Details -->
                <div class="assignment-details">
                    <RadzenRow Gap="1rem">
                        <RadzenColumn Size="6">
                            <div class="detail-item">
                                <RadzenIcon Icon="person" Class="detail-icon" />
                                <div>
                                    <RadzenText TextStyle="TextStyle.Caption" Class="text-muted mb-0">
                                        @T("labels.employee")
                                    </RadzenText>
                                    <RadzenText TextStyle="TextStyle.Body2" Class="fw-bold mb-0">
                                        @Assignment.EmployeeName
                                    </RadzenText>
                                </div>
                            </div>
                        </RadzenColumn>
                        <RadzenColumn Size="6">
                            <div class="detail-item">
                                <RadzenIcon Icon="event" Class="detail-icon" />
                                <div>
                                    <RadzenText TextStyle="TextStyle.Caption" Class="text-muted mb-0">
                                        @T("labels.assigned-date")
                                    </RadzenText>
                                    <RadzenText TextStyle="TextStyle.Body2" Class="fw-bold mb-0">
                                        @Assignment.AssignedDate.ToString("MMM dd, yyyy")
                                    </RadzenText>
                                </div>
                            </div>
                        </RadzenColumn>
                    </RadzenRow>

                    <RadzenRow Gap="1rem" class="mt-2">
                        <RadzenColumn Size="6">
                            <div class="detail-item">
                                <RadzenIcon Icon="quiz" Class="detail-icon" />
                                <div>
                                    <RadzenText TextStyle="TextStyle.Caption" Class="text-muted mb-0">
                                        @T("labels.sections")
                                    </RadzenText>
                                    <RadzenText TextStyle="TextStyle.Body2" Class="fw-bold mb-0">
                                        @Template.Sections.Count @T("labels.sections-count")
                                    </RadzenText>
                                </div>
                            </div>
                        </RadzenColumn>
                        <RadzenColumn Size="6">
                            <div class="detail-item">
                                <RadzenIcon Icon="schedule" Class="detail-icon" />
                                <div>
                                    <RadzenText TextStyle="TextStyle.Caption" Class="text-muted mb-0">
                                        @T("labels.current-status")
                                    </RadzenText>
                                    <RadzenBadge BadgeStyle="BadgeStyle.Warning" Text="@T("workflow-states.InReview")" />
                                </div>
                            </div>
                        </RadzenColumn>
                    </RadzenRow>
                </div>
            </div>

            <!-- Review Progress Information -->
            <div class="review-progress">
                <RadzenAlert AlertStyle="AlertStyle.Info" Variant="Variant.Flat" Shade="Shade.Lighter" ShowIcon="true">
                    <RadzenText TextStyle="TextStyle.Body2">
                        <strong>@T("labels.review-meeting-active"):</strong>
                        <span> @T("messages.review-meeting-progress-description")</span>
                    </RadzenText>
                </RadzenAlert>
            </div>

            <!-- Section Overview -->
            @if (Template.Sections.Any())
            {
                <div class="sections-overview">
                    <RadzenText TextStyle="TextStyle.Subtitle2" Class="fw-bold mb-2">
                        @T("sections.questionnaire-sections")
                    </RadzenText>
                    <div class="sections-list">
                        @foreach (var section in Template.Sections.OrderBy(s => s.Order))
                        {
                            <div class="section-item">
                                <RadzenIcon Icon="@GetSectionIcon(section.Type)" Class="section-icon" />
                                <div class="section-info">
                                    <RadzenText TextStyle="TextStyle.Body2" Class="mb-0">
                                        @(section.GetLocalizedTitleWithFallback(CurrentLanguage))
                                    </RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" Class="text-muted">
                                        @GetSectionTypeLabel(section.Type) â€¢ @GetCompletionRoleLabel(section.CompletionRole)
                                    </RadzenText>
                                </div>
                                @if (section.IsRequired)
                                {
                                    <RadzenBadge BadgeStyle="BadgeStyle.Danger" Text="@T("labels.required")" />
                                }
                            </div>
                        }
                    </div>
                </div>
            }
        </RadzenStack>
    </RadzenCard>
</div>

<style>
.review-summary-card {
    margin-bottom: 1rem;
}

.detail-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
}

.detail-icon {
    color: var(--primary-color);
    margin-top: 0.125rem;
    font-size: 1rem;
}

.sections-list {
    max-height: 300px;
    overflow-y: auto;
}

.section-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.section-item:last-child {
    border-bottom: none;
}

.section-icon {
    color: var(--success-color);
    font-size: 1rem;
    flex-shrink: 0;
}

.section-info {
    flex-grow: 1;
    min-width: 0;
}
</style>

@code {
    [Parameter, EditorRequired] public QuestionnaireAssignment Assignment { get; set; } = null!;
    [Parameter, EditorRequired] public QuestionnaireTemplate Template { get; set; } = null!;

    private string GetSectionIcon(QuestionType type)
    {
        return type switch
        {
            QuestionType.Assessment => "assessment",
            QuestionType.TextQuestion => "edit_note",
            QuestionType.Goal => "flag",
            _ => "quiz"
        };
    }

    private string GetSectionTypeLabel(QuestionType type)
    {
        return type switch
        {
            QuestionType.Assessment => T("labels.assessment"),
            QuestionType.TextQuestion => T("labels.text-question"),
            QuestionType.Goal => T("labels.goal"),
            _ => T("labels.unknown")
        };
    }

    private string GetCompletionRoleLabel(CompletionRole role)
    {
        return role switch
        {
            CompletionRole.Employee => T("labels.employee-only"),
            CompletionRole.Manager => T("labels.manager-only"),
            CompletionRole.Both => T("labels.both-roles"),
            _ => T("labels.unknown")
        };
    }
}