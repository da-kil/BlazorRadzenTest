@using Radzen.Blazor
@using ti8m.BeachBreak.Client.Models
@using ti8m.BeachBreak.Client.Components.QuestionnaireBuilder
@using ti8m.BeachBreak.Client.Components.Shared
@using System.Collections
@inherits OptimizedTranslatableComponentBase

<div class="modern-section-card">
    <!-- Enhanced Section Header with proper action button placement -->
    <div class="section-header-modern">
        <!-- Header Top Row: Type indicators and Action Buttons -->
        <div class="header-top-row">
            <div class="section-badges">
                <div class="section-type-badge">
                    <RadzenIcon Icon="@GetSectionTypeIcon()" Class="badge-icon" />
                    <span class="badge-text">@GetSectionTypeName()</span>
                </div>
                <div class="completion-role-badge">
                    <RadzenIcon Icon="@Section.GetRoleIcon()" Class="badge-icon" />
                    <span class="badge-text">@GetCompletionRoleText()</span>
                </div>
            </div>

            <!-- Action Buttons - moved to dedicated area -->
            <ItemActionsComponent
                OnMoveUp="@(() => OnMoveUpClick())"
                OnMoveDown="@(() => OnMoveDownClick())"
                OnDelete="@(() => OnDeleteClick())"
                MoveUpDisabled="@(!CanMoveUp)"
                MoveDownDisabled="@(!CanMoveDown)"
                MoveUpTitle="Move section up"
                MoveDownTitle="Move section down"
                DeleteTitle="Delete section"
                DeleteProcessingText="Deleting"
                ButtonSize="ButtonSize.Small"
                CustomButtonClass="action-btn"
                GlobalDisabled="@(!Template.IsAvailableForEditing)"
                AdditionalClasses="section-actions" />
        </div>

        @* Only show role assignment for Assessment, TextQuestion, and Goal sections *@
        @if (Section.Type != QuestionType.EmployeeFeedback)
        {
            <!-- Header Content Row: Role selector -->
            <div class="header-content-row">
                <div class="role-assignment-section">
                    <RadzenText TextStyle="TextStyle.Caption" Class="role-label">Who completes this section?</RadzenText>
                    @if (!Template.RequiresManagerReview)
                    {
                        <RadzenText TextStyle="TextStyle.Caption" Class="text-warning d-block mb-2">
                            <RadzenIcon Icon="info" Style="font-size: 0.875rem;" />
                            Manager review disabled - sections must be completed by employees only
                        </RadzenText>
                    }
                    <RadzenRadioButtonList @bind-Value="@Section.CompletionRole"
                                           Data="@GetFilteredRoleOptions()"
                                           TextProperty="Text"
                                           ValueProperty="Value"
                                           Orientation="Radzen.Orientation.Horizontal"
                                           Class="role-select-modern"
                                           Disabled="@(!Template.IsAvailableForEditing)" />
                </div>
            </div>
        }
    </div>

    <!-- Section Content Area -->
    <div class="section-content-modern">

        <!-- Title Inputs -->
        <MultilingualInputComponent
            EnglishLabel="English Title"
            GermanLabel="German Title"
            EnglishValue="@Section.TitleEnglish"
            GermanValue="@Section.TitleGerman"
            EnglishValueChanged="@OnSectionTitleEnglishChanged"
            GermanValueChanged="@OnSectionTitleGermanChanged"
            EnglishPlaceholder="@T("placeholders.section-title-english-example")"
            GermanPlaceholder="@T("placeholders.section-title-german-example")"
            InputType="InputType.TextBox"
            InputCssClass="title-input-modern"
            AdditionalClasses="mb-3"
            Required="true"
            Disabled="@(!Template.IsAvailableForEditing)" />

        <!-- Description Inputs -->
        <MultilingualInputComponent
            EnglishLabel="English Description"
            GermanLabel="German Description"
            EnglishValue="@Section.DescriptionEnglish"
            GermanValue="@Section.DescriptionGerman"
            EnglishValueChanged="@OnSectionDescriptionEnglishChanged"
            GermanValueChanged="@OnSectionDescriptionGermanChanged"
            EnglishPlaceholder="@T("placeholders.section-description-english")"
            GermanPlaceholder="@T("placeholders.section-description-german")"
            InputType="InputType.TextArea"
            InputCssClass="description-input-modern"
            AdditionalClasses="mb-3"
            TextAreaRows="3"
            Required="true"
            Disabled="@(!Template.IsAvailableForEditing)" />

        <!-- Rating Scale Configuration - only for Assessment sections -->
        @if (Section.Type == QuestionType.Assessment)
        {
            <div class="rating-scale-config-modern">
                <div class="config-header">
                    <RadzenIcon Icon="tune" Class="config-icon" />
                    <RadzenText TextStyle="TextStyle.Body1" Class="config-title">Rating Scale Configuration</RadzenText>
                </div>
                <div class="rating-scale-grid">
                    <div class="scale-input">
                        <RadzenText TextStyle="TextStyle.Caption" Class="input-label">Scale</RadzenText>
                        <RadzenDropDown Value="@GetRatingScale()"
                                       ValueChanged="@((int value) => SetRatingScale(value))"
                                       Data="@(new List<int> { 3, 4, 5, 7, 10 })"
                                       Class="modern-dropdown"
                                       Disabled="@(!Template.IsAvailableForEditing)" />
                    </div>
                    <div class="scale-input">
                        <RadzenText TextStyle="TextStyle.Caption" Class="input-label">Low Label</RadzenText>
                        <RadzenTextBox Value="@GetScaleLowLabel()"
                                      ValueChanged="@((string value) => SetScaleLowLabel(value))"
                                      Placeholder="@T("placeholders.scale-low-label-example")"
                                      Class="modern-textbox"
                                      Disabled="@(!Template.IsAvailableForEditing)" />
                    </div>
                    <div class="scale-input">
                        <RadzenText TextStyle="TextStyle.Caption" Class="input-label">High Label</RadzenText>
                        <RadzenTextBox Value="@GetScaleHighLabel()"
                                      ValueChanged="@((string value) => SetScaleHighLabel(value))"
                                      Placeholder="@T("placeholders.scale-high-label-example")"
                                      Class="modern-textbox"
                                      Disabled="@(!Template.IsAvailableForEditing)" />
                    </div>
                </div>
            </div>
        }

        <!-- Enhanced Section Stats -->
        @if (GetItemCount() > 0)
        {
            <div class="section-stats-modern">
                <div class="stat-item">
                    <RadzenIcon Icon="quiz" Class="stat-icon" />
                    <span class="stat-number">@GetItemCount()</span>
                    <span class="stat-label">items</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <RadzenIcon Icon="star" Class="stat-icon" />
                    <span class="stat-number">@GetRequiredItemCount()</span>
                    <span class="stat-label">required</span>
                </div>
            </div>
        }
    </div>

    <!-- Items Area - No padding for consistent flat design -->
    <div class="items-area">
        @* Only show Items header and Add Item button for Assessment and TextQuestion sections *@
        @if (Section.Type != QuestionType.Goal && Section.Type != QuestionType.EmployeeFeedback)
        {
            <div class="items-header mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <RadzenText TextStyle="TextStyle.Subtitle2" Class="fw-bold mb-0 d-flex align-items-center">
                        <RadzenIcon Icon="@GetSectionTypeIcon()" Style="@($"color: {GetSectionTypeColor()};")" Class="me-2" />
                        @GetSectionTypeName() Items
                    </RadzenText>
                    <AsyncButton Text="Add Item"
                                ButtonStyle="ButtonStyle.Primary"
                                Icon="add_circle_outline"
                                Size="ButtonSize.Small"
                                Click="@(() => OnAddItemClick())"
                                Disabled="@(!Template.IsAvailableForEditing)" />
                </div>
            </div>
        }

        @* Simplified question rendering using dedicated renderers *@
        @if (IsSectionInitialized())
        {
            <div class="items-list">
                <QuestionRendererFactory
                    Section="@Section"
                    Template="@Template"
                    OnMoveEvaluationUp="@OnMoveEvaluationUp"
                    OnMoveEvaluationDown="@OnMoveEvaluationDown"
                    OnRemoveEvaluation="@OnRemoveEvaluation"
                    OnUpdateEvaluationRequired="@OnUpdateEvaluationRequired"
                    OnUpdateEvaluationTitleEnglish="@OnUpdateEvaluationTitleEnglish"
                    OnUpdateEvaluationTitleGerman="@OnUpdateEvaluationTitleGerman"
                    OnUpdateEvaluationDescriptionEnglish="@OnUpdateEvaluationDescriptionEnglish"
                    OnUpdateEvaluationDescriptionGerman="@OnUpdateEvaluationDescriptionGerman"
                    OnMoveTextSectionUp="@OnMoveTextSectionUp"
                    OnMoveTextSectionDown="@OnMoveTextSectionDown"
                    OnRemoveTextSection="@OnRemoveTextSection"
                    OnUpdateTextSectionRequired="@OnUpdateTextSectionRequired"
                    OnUpdateTextSectionTitleEnglish="@OnUpdateTextSectionTitleEnglish"
                    OnUpdateTextSectionTitleGerman="@OnUpdateTextSectionTitleGerman"
                    OnUpdateTextSectionDescriptionEnglish="@OnUpdateTextSectionDescriptionEnglish"
                    OnUpdateTextSectionDescriptionGerman="@OnUpdateTextSectionDescriptionGerman" />
            </div>
        }
        else
        {
            <div class="section-info text-center py-3">
                <RadzenIcon Icon="add_circle" Style="font-size: 2rem;" Class="mb-2 text-muted" />
                <RadzenText TextStyle="TextStyle.Body2" Class="text-muted">
                    Click "Add Item" to choose a question type for this section
                </RadzenText>
            </div>
        }
    </div>
</div>


@code {
    [Parameter, EditorRequired] public QuestionSection Section { get; set; } = null!;
    [Parameter, EditorRequired] public QuestionnaireTemplate Template { get; set; } = null!;
    [Parameter, EditorRequired] public bool CanMoveUp { get; set; }
    [Parameter, EditorRequired] public bool CanMoveDown { get; set; }

    [Parameter] public EventCallback OnMoveUp { get; set; }
    [Parameter] public EventCallback OnMoveDown { get; set; }
    [Parameter] public EventCallback OnDelete { get; set; }
    [Parameter] public EventCallback OnAddItemDirectly { get; set; }
    [Parameter] public EventCallback<int> OnMoveQuestionUp { get; set; }
    [Parameter] public EventCallback<int> OnMoveQuestionDown { get; set; }
    [Parameter] public EventCallback<int> OnDeleteQuestion { get; set; }
    [Parameter] public EventCallback<string> OnTitleEnglishChanged { get; set; }
    [Parameter] public EventCallback<string> OnTitleGermanChanged { get; set; }
    [Parameter] public EventCallback<string> OnDescriptionEnglishChanged { get; set; }
    [Parameter] public EventCallback<string> OnDescriptionGermanChanged { get; set; }
    [Parameter] public EventCallback OnItemChanged { get; set; } // New callback for when evaluation items/text sections change

    private async Task OnMoveUpClick() => await OnMoveUp.InvokeAsync();
    private async Task OnMoveDownClick() => await OnMoveDown.InvokeAsync();
    private async Task OnDeleteClick() => await OnDelete.InvokeAsync();
    private async Task OnAddItemClick() => await OnAddItemDirectly.InvokeAsync();


    private async Task OnSectionTitleEnglishChanged(string value)
    {
        Section.TitleEnglish = value ?? "";
        await OnTitleEnglishChanged.InvokeAsync(value);
    }

    private async Task OnSectionTitleGermanChanged(string value)
    {
        Section.TitleGerman = value ?? "";
        await OnTitleGermanChanged.InvokeAsync(value);
    }

    private async Task OnSectionDescriptionEnglishChanged(string value)
    {
        Section.DescriptionEnglish = value ?? "";
        await OnDescriptionEnglishChanged.InvokeAsync(value);
    }

    private async Task OnSectionDescriptionGermanChanged(string value)
    {
        Section.DescriptionGerman = value ?? "";
        await OnDescriptionGermanChanged.InvokeAsync(value);
    }

    // Assessment item methods
    private List<EvaluationItem> GetOrderedEvaluations()
    {
        if (Section.Configuration is AssessmentConfiguration config)
        {
            return config.Evaluations.OrderBy(e => e.Order).ToList();
        }
        return new List<EvaluationItem>();
    }

    private async void UpdateAssessmentConfiguration(List<EvaluationItem> evaluations)
    {
        if (Section.Configuration is AssessmentConfiguration config)
        {
            config.Evaluations = evaluations;
        }
        StateHasChanged();
        await OnItemChanged.InvokeAsync(); // Notify parent that evaluation items changed
    }

    private void UpdateEvaluationRequired(int index, bool value)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count)
        {
            evaluations[index].IsRequired = value;
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void MoveEvaluationUp(int index)
    {
        var evaluations = GetOrderedEvaluations();
        if (index > 0 && index < evaluations.Count)
        {
            (evaluations[index], evaluations[index - 1]) = (evaluations[index - 1], evaluations[index]);
            for (int i = 0; i < evaluations.Count; i++)
            {
                evaluations[i].Order = i;
            }
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void MoveEvaluationDown(int index)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count - 1)
        {
            (evaluations[index], evaluations[index + 1]) = (evaluations[index + 1], evaluations[index]);
            for (int i = 0; i < evaluations.Count; i++)
            {
                evaluations[i].Order = i;
            }
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void RemoveEvaluation(int index)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count)
        {
            evaluations.RemoveAt(index);
            for (int i = 0; i < evaluations.Count; i++)
            {
                evaluations[i].Order = i;
            }
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void UpdateEvaluationTitleEnglish(int index, string value)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count)
        {
            evaluations[index].TitleEnglish = value ?? "";
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void UpdateEvaluationTitleGerman(int index, string value)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count)
        {
            evaluations[index].TitleGerman = value ?? "";
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void UpdateEvaluationDescriptionEnglish(int index, string value)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count)
        {
            evaluations[index].DescriptionEnglish = value ?? "";
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    private void UpdateEvaluationDescriptionGerman(int index, string value)
    {
        var evaluations = GetOrderedEvaluations();
        if (index >= 0 && index < evaluations.Count)
        {
            evaluations[index].DescriptionGerman = value ?? "";
            UpdateAssessmentConfiguration(evaluations);
        }
    }

    // Text question item methods
    private List<TextSection> GetOrderedTextSections()
    {
        if (Section.Configuration is TextQuestionConfiguration config)
        {
            return config.TextSections.OrderBy(s => s.Order).ToList();
        }
        return new List<TextSection>();
    }

    private async void UpdateTextQuestionConfiguration(List<TextSection> sections)
    {
        if (Section.Configuration is TextQuestionConfiguration config)
        {
            config.TextSections = sections;
        }
        StateHasChanged();
        await OnItemChanged.InvokeAsync(); // Notify parent that text sections changed
    }

    private void UpdateTextSectionRequired(int index, bool value)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count)
        {
            sections[index].IsRequired = value;
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void MoveTextSectionUp(int index)
    {
        var sections = GetOrderedTextSections();
        if (index > 0 && index < sections.Count)
        {
            (sections[index], sections[index - 1]) = (sections[index - 1], sections[index]);
            for (int i = 0; i < sections.Count; i++)
            {
                sections[i].Order = i;
            }
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void MoveTextSectionDown(int index)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count - 1)
        {
            (sections[index], sections[index + 1]) = (sections[index + 1], sections[index]);
            for (int i = 0; i < sections.Count; i++)
            {
                sections[i].Order = i;
            }
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void RemoveTextSection(int index)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count)
        {
            sections.RemoveAt(index);
            for (int i = 0; i < sections.Count; i++)
            {
                sections[i].Order = i;
            }
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void UpdateTextSectionTitleEnglish(int index, string value)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count)
        {
            sections[index].TitleEnglish = value ?? "";
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void UpdateTextSectionTitleGerman(int index, string value)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count)
        {
            sections[index].TitleGerman = value ?? "";
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void UpdateTextSectionDescriptionEnglish(int index, string value)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count)
        {
            sections[index].DescriptionEnglish = value ?? "";
            UpdateTextQuestionConfiguration(sections);
        }
    }

    private void UpdateTextSectionDescriptionGerman(int index, string value)
    {
        var sections = GetOrderedTextSections();
        if (index >= 0 && index < sections.Count)
        {
            sections[index].DescriptionGerman = value ?? "";
            UpdateTextQuestionConfiguration(sections);
        }
    }


    private string GetSectionNumber()
    {
        // This could be enhanced to get the actual section number from parent
        return (Section.Order + 1).ToString();
    }

    private string GetSectionTypeIcon()
    {
        return Section.GetTypeIcon();
    }

    private string GetSectionTypeName()
    {
        return Section.GetTypeName();
    }

    private string GetSectionTypeColor()
    {
        return Section.GetTypeColor();
    }

    private int GetItemCount()
    {
        return Section.GetItemCount();
    }

    private int GetRequiredItemCount()
    {
        return Section.GetRequiredItemCount();
    }

    private bool IsSectionInitialized()
    {
        // Check if the section has been properly initialized with a configuration
        return Section.Type switch
        {
            QuestionType.Assessment => Section.Configuration is AssessmentConfiguration config && config.Evaluations.Count > 0,
            QuestionType.TextQuestion => Section.Configuration is TextQuestionConfiguration config && config.TextSections.Count > 0,
            QuestionType.Goal => Section.Configuration is GoalConfiguration,
            QuestionType.EmployeeFeedback => Section.Configuration is EmployeeFeedbackConfiguration,
            _ => false
        };
    }

    // Rating scale configuration methods for Assessment sections
    private int GetRatingScale()
    {
        if (Section.Configuration is AssessmentConfiguration config)
        {
            return config.RatingScale;
        }
        return 4; // Default
    }

    private void SetRatingScale(int value)
    {
        // Apply to Section's configuration
        if (Section.Configuration is AssessmentConfiguration config)
        {
            config.RatingScale = value;
        }
        StateHasChanged();
    }

    private string GetScaleLowLabel()
    {
        if (Section.Configuration is AssessmentConfiguration config)
        {
            return config.ScaleLowLabel ?? "Poor";
        }
        return "Poor";
    }

    private void SetScaleLowLabel(string value)
    {
        // Apply to Section's configuration
        if (Section.Configuration is AssessmentConfiguration config)
        {
            config.ScaleLowLabel = value ?? "Poor";
        }
        StateHasChanged();
    }

    private string GetScaleHighLabel()
    {
        if (Section.Configuration is AssessmentConfiguration config)
        {
            return config.ScaleHighLabel ?? "Excellent";
        }
        return "Excellent";
    }

    private void SetScaleHighLabel(string value)
    {
        // Apply to Section's configuration
        if (Section.Configuration is AssessmentConfiguration config)
        {
            config.ScaleHighLabel = value ?? "Excellent";
        }
        StateHasChanged();
    }

    // Role selection support
    private List<RoleOption> roleOptions = new()
    {
        new() { Value = CompletionRole.Employee, Text = "Employee", Icon = "person" },
        new() { Value = CompletionRole.Manager, Text = "Manager", Icon = "supervisor_account" },
        new() { Value = CompletionRole.Both, Text = "Both", Icon = "groups" }
    };

    private List<RoleOption> GetFilteredRoleOptions()
    {
        // If manager review is not required, only allow Employee role
        if (!Template.RequiresManagerReview)
        {
            // Ensure section is set to Employee
            if (Section.CompletionRole != CompletionRole.Employee)
            {
                Section.CompletionRole = CompletionRole.Employee;
            }
            return roleOptions.Where(r => r.Value == CompletionRole.Employee).ToList();
        }
        return roleOptions;
    }

    private string GetCompletionRoleText()
    {
        return Section.CompletionRole switch
        {
            CompletionRole.Employee => "Employee",
            CompletionRole.Manager => "Manager",
            CompletionRole.Both => "Both",
            _ => "Unknown"
        };
    }

    // Wrapper methods for QuestionRendererFactory callbacks (convert from tuple parameters)
    private EventCallback<int> OnMoveEvaluationUp => EventCallback.Factory.Create<int>(this, index => MoveEvaluationUp(index));
    private EventCallback<int> OnMoveEvaluationDown => EventCallback.Factory.Create<int>(this, index => MoveEvaluationDown(index));
    private EventCallback<int> OnRemoveEvaluation => EventCallback.Factory.Create<int>(this, index => RemoveEvaluation(index));
    private EventCallback<(int, bool)> OnUpdateEvaluationRequired => EventCallback.Factory.Create<(int, bool)>(this, args => UpdateEvaluationRequired(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateEvaluationTitleEnglish => EventCallback.Factory.Create<(int, string)>(this, args => UpdateEvaluationTitleEnglish(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateEvaluationTitleGerman => EventCallback.Factory.Create<(int, string)>(this, args => UpdateEvaluationTitleGerman(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateEvaluationDescriptionEnglish => EventCallback.Factory.Create<(int, string)>(this, args => UpdateEvaluationDescriptionEnglish(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateEvaluationDescriptionGerman => EventCallback.Factory.Create<(int, string)>(this, args => UpdateEvaluationDescriptionGerman(args.Item1, args.Item2));

    private EventCallback<int> OnMoveTextSectionUp => EventCallback.Factory.Create<int>(this, index => MoveTextSectionUp(index));
    private EventCallback<int> OnMoveTextSectionDown => EventCallback.Factory.Create<int>(this, index => MoveTextSectionDown(index));
    private EventCallback<int> OnRemoveTextSection => EventCallback.Factory.Create<int>(this, index => RemoveTextSection(index));
    private EventCallback<(int, bool)> OnUpdateTextSectionRequired => EventCallback.Factory.Create<(int, bool)>(this, args => UpdateTextSectionRequired(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateTextSectionTitleEnglish => EventCallback.Factory.Create<(int, string)>(this, args => UpdateTextSectionTitleEnglish(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateTextSectionTitleGerman => EventCallback.Factory.Create<(int, string)>(this, args => UpdateTextSectionTitleGerman(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateTextSectionDescriptionEnglish => EventCallback.Factory.Create<(int, string)>(this, args => UpdateTextSectionDescriptionEnglish(args.Item1, args.Item2));
    private EventCallback<(int, string)> OnUpdateTextSectionDescriptionGerman => EventCallback.Factory.Create<(int, string)>(this, args => UpdateTextSectionDescriptionGerman(args.Item1, args.Item2));

    public class RoleOption
    {
        public CompletionRole Value { get; set; }
        public string Text { get; set; } = string.Empty;
        public string Icon { get; set; } = string.Empty;
    }
}