@using Radzen.Blazor
@using ti8m.BeachBreak.Client.Models
@inherits ti8m.BeachBreak.Client.Components.Shared.OptimizedTranslatableComponentBase

<div class="basic-info-content">

    <RadzenRow Gap="1rem">
        <RadzenColumn Size="12" SizeMD="6">
            <div class="mb-3">
                <RadzenText TextStyle="TextStyle.Body1" Class="fw-bold mb-2">@T("labels.english-template-name-required")</RadzenText>
                <RadzenTextBox @bind-Value="@Template.NameEnglish"
                              Placeholder="@T("placeholders.enter-template-name-english")"
                              Class="w-100"
                              Disabled="@(!Template.IsAvailableForEditing)" />
            </div>
        </RadzenColumn>
        <RadzenColumn Size="12" SizeMD="6">
            <div class="mb-3">
                <RadzenText TextStyle="TextStyle.Body1" Class="fw-bold mb-2">@T("labels.german-template-name-optional")</RadzenText>
                <RadzenTextBox @bind-Value="@Template.NameGerman"
                              Placeholder="@T("placeholders.enter-template-name-german-optional")"
                              Class="w-100"
                              Disabled="@(!Template.IsAvailableForEditing)" />
            </div>
        </RadzenColumn>
    </RadzenRow>

    <RadzenRow Gap="1rem" Class="mb-3">
        <RadzenColumn Size="12" SizeMD="6">
            <div class="mb-3">
                <RadzenText TextStyle="TextStyle.Body1" Class="fw-bold mb-2">@T("labels.questionnaire-type-required")</RadzenText>
                <RadzenDropDown @bind-Value="@Template.CategoryId"
                               Data="@Categories"
                               TextProperty="@GetCategoryNameProperty()"
                               ValueProperty="Id"
                               Placeholder="@T("placeholders.select-type-annual-review")"
                               AllowClear="false"
                               Class="w-100"
                               Disabled="@(!Template.IsAvailableForEditing)" />
            </div>
        </RadzenColumn>
    </RadzenRow>

    <RadzenRow Gap="1rem" Class="mb-3">
        <RadzenColumn Size="12" SizeMD="6">
            <div class="mb-3">
                <RadzenText TextStyle="TextStyle.Body1" Class="fw-bold mb-2">@T("labels.english-description-required")</RadzenText>
                <RadzenTextArea @bind-Value="@Template.DescriptionEnglish"
                              Placeholder="@T("placeholders.describe-purpose-scope-english")"
                              Rows="4"
                              Class="w-100"
                              Disabled="@(!Template.IsAvailableForEditing)" />
            </div>
        </RadzenColumn>
        <RadzenColumn Size="12" SizeMD="6">
            <div class="mb-3">
                <RadzenText TextStyle="TextStyle.Body1" Class="fw-bold mb-2">@T("labels.german-description-optional")</RadzenText>
                <RadzenTextArea @bind-Value="@Template.DescriptionGerman"
                              Placeholder="@T("placeholders.describe-purpose-scope-german-optional")"
                              Rows="4"
                              Class="w-100"
                              Disabled="@(!Template.IsAvailableForEditing)" />
            </div>
        </RadzenColumn>
    </RadzenRow>

    <div class="settings-section mt-4 p-3 rounded border">
        <RadzenText TextStyle="TextStyle.Subtitle1" Class="fw-bold mb-3">@T("sections.workflow-configuration")</RadzenText>
        <div class="mb-3">
            <RadzenLabel Text="@T("labels.process-type")" Component="processType" Class="font-medium" />
            <div class="d-flex align-items-center gap-2 mt-1">
                <RadzenBadge BadgeStyle="@(Template.ProcessType.GetBadgeStyle())"
                            Text="@GetProcessTypeDisplayName(Template.ProcessType)"
                            Class="px-3 py-2" />
                <RadzenIcon Icon="@(Template.ProcessType.GetIcon())" />
                @if (Template.IsAvailableForEditing && showProcessTypeChangeWarning)
                {
                    <RadzenButton Text="@T("buttons.change")"
                                ButtonStyle="ButtonStyle.Light"
                                Size="ButtonSize.ExtraSmall"
                                Click="@ShowProcessTypeChangeDialog" />
                }
            </div>
            <RadzenText TextStyle="TextStyle.Caption" Class="text-muted d-block mt-1">
                @GetProcessTypeDescription(Template.ProcessType)
            </RadzenText>
            <RadzenText TextStyle="TextStyle.Caption" Class="text-muted d-block mt-1">
                <RadzenIcon Icon="info" Style="font-size: 14px; vertical-align: middle;" />
                @T("messages.process-type-set-at-creation")
            </RadzenText>
        </div>
        <div class="mb-3">
            <RadzenCheckBox @bind-Value="@Template.IsCustomizable" Name="isCustomizable" Disabled="@(!Template.IsAvailableForEditing)" />
            <RadzenLabel Text="@T("templates.allows-customization")" Component="isCustomizable" Class="font-medium" />
            <RadzenText TextStyle="TextStyle.Caption" Class="text-muted d-block mt-1 ms-4">
                @T("templates.customization-tooltip")
            </RadzenText>
        </div>
        <div class="mb-3">
            <RadzenCheckBox @bind-Value="@Template.AutoInitialize" Name="autoInitialize" Disabled="@(!Template.IsAvailableForEditing)" />
            <RadzenLabel Text="@T("templates.auto-initialize")" Component="autoInitialize" Class="font-medium" />
            <RadzenText TextStyle="TextStyle.Caption" Class="text-muted d-block mt-1 ms-4">
                @T("templates.auto-initialize-tooltip")
            </RadzenText>
        </div>
    </div>
</div>

@code {
    [Parameter, EditorRequired] public QuestionnaireTemplate Template { get; set; } = null!;
    [Parameter, EditorRequired] public IReadOnlyList<Category> Categories { get; set; } = null!;

    private bool showProcessTypeChangeWarning = false; // For future enhancement: allow changing with warning

    protected override Task OnInitializedAsync()
    {
        return base.OnInitializedAsync();
    }

    private Task ShowProcessTypeChangeDialog()
    {
        // Future enhancement: Show dialog to change process type with validation warnings
        return Task.CompletedTask;
    }

    private string GetCategoryNameProperty()
    {
        return CurrentLanguage == Language.German ? "NameDe" : "NameEn";
    }

    private string GetProcessTypeDisplayName(QuestionnaireProcessType processType)
    {
        return processType switch
        {
            QuestionnaireProcessType.PerformanceReview => T("process-types.performance-review"),
            QuestionnaireProcessType.Survey => T("process-types.survey"),
            _ => processType.ToString()
        };
    }

    private string GetProcessTypeDescription(QuestionnaireProcessType processType)
    {
        return processType switch
        {
            QuestionnaireProcessType.PerformanceReview => T("process-types.performance-review-description"),
            QuestionnaireProcessType.Survey => T("process-types.survey-description"),
            _ => string.Empty
        };
    }
}