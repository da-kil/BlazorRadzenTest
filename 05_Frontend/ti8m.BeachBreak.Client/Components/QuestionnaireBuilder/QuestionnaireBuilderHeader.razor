@using Radzen
@using Radzen.Blazor
@using ti8m.BeachBreak.Client.Models
@using ti8m.BeachBreak.Client.Components.Shared

<!-- Header -->
<div class="page-header-modern">
	<div class="container-fluid">
		<div class="d-flex justify-content-between align-items-center py-3">
			<div class="d-flex align-items-center">
				<RadzenText TextStyle="TextStyle.H4" Class="text-white fw-bold mb-0">
					<RadzenIcon Icon="psychology" Class="me-2" />
					@(IsEditMode ? "Questionnaire Editor" : "Questionnaire Builder")
				</RadzenText>
				<div class="status-badge ms-3">
					@{
						var status = IsEditMode ? Status : TemplateStatus.Draft;
						var statusText = IsEditMode ? TemplateStatusHelper.GetStatusText(Status) : "NEW";
						var statusIcon = IsEditMode ? TemplateStatusHelper.GetStatusIcon(Status) : "add_circle";
						var statusClass = IsEditMode ? TemplateStatusHelper.GetStatusBadgeClass(Status) : "badge bg-info text-dark";
					}
					<span class="@statusClass d-flex align-items-center px-3 py-1">
						<RadzenIcon Icon="@statusIcon" Class="me-1" Style="font-size: 0.8rem;" />
						@statusText
					</span>
				</div>
				@if (LastSavedTime.HasValue && !IsSaving)
				{
					<div class="ms-3 text-white-50 d-flex align-items-center" style="font-size: 0.875rem;">
						<RadzenIcon Icon="cloud_done" Class="me-1" style="color: #4ade80;" />
						Last saved @LastSavedTime.Value.ToString("HH:mm")
					</div>
				}
				@if (IsSaving)
				{
					<div class="ms-3 text-white-50 d-flex align-items-center" style="font-size: 0.875rem;">
						<RadzenIcon Icon="sync" Class="me-1 rotating-icon" style="color: #60a5fa;" />
						Saving...
					</div>
				}
			</div>
			<div class="d-flex gap-2">
				@{
					var currentStatus = IsEditMode ? Status : TemplateStatus.Draft;
				}
				@switch (currentStatus)
				{
					case TemplateStatus.Draft:
						<StandardizedButton Action="StandardizedButton.ButtonAction.Clone" Click="@OnClone" Disabled="@IsSaving" />
						<StandardizedButton Action="StandardizedButton.ButtonAction.Save" ProcessingText="Saving" Click="@OnSave" Disabled="@IsSaving" />
						<StandardizedButton Action="StandardizedButton.ButtonAction.Publish" ProcessingText="Publishing" Click="@OnPublish" Disabled="@IsSaving" />
						<StandardizedButton Action="StandardizedButton.ButtonAction.Archive" ProcessingText="Archiving" Click="@OnArchive" Disabled="@IsSaving" />
						break;
					case TemplateStatus.Published:
						<StandardizedButton Action="StandardizedButton.ButtonAction.Clone" ProcessingText="Cloning" Click="@OnClone" />
						<StandardizedButton Action="StandardizedButton.ButtonAction.Unpublish" ProcessingText="Unpublishing" Click="@OnUnpublish" />
						<StandardizedButton Action="StandardizedButton.ButtonAction.Archive" ProcessingText="Archiving" Click="@OnArchive" />
						break;
					case TemplateStatus.Archived:
						<StandardizedButton Action="StandardizedButton.ButtonAction.Clone" ProcessingText="Cloning" Click="@OnClone" />
						<StandardizedButton Action="StandardizedButton.ButtonAction.Restore" ProcessingText="Restoring" Click="@OnRestore" />
						break;
				}
			</div>
		</div>
	</div>
</div>

<style>
	.rotating-icon {
		animation: rotate 2s linear infinite;
	}

	@@keyframes rotate {
		from {
			transform: rotate(0deg);
		}
		to {
			transform: rotate(360deg);
		}
	}
</style>

@code {
	[Parameter] public bool IsEditMode { get; set; }
	[Parameter] public TemplateStatus Status { get; set; }
	[Parameter] public bool IsSaving { get; set; }
	[Parameter] public DateTime? LastSavedTime { get; set; }

	[Parameter] public EventCallback OnSave { get; set; }
	[Parameter] public EventCallback OnPublish { get; set; }
	[Parameter] public EventCallback OnArchive { get; set; }
	[Parameter] public EventCallback OnUnpublish { get; set; }
	[Parameter] public EventCallback OnRestore { get; set; }
	[Parameter] public EventCallback OnClone { get; set; }
}
