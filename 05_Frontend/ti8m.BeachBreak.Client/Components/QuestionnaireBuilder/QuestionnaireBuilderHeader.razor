@using Radzen
@using Radzen.Blazor
@using ti8m.BeachBreak.Client.Models
@using ti8m.BeachBreak.Client.Components.Shared

<!-- Enhanced Modern Header -->
<div class="questionnaire-header-modern">
	<div class="container-fluid">
		<div class="header-content">
			<div class="header-left">
				<div class="title-section">
					<RadzenText TextStyle="TextStyle.H4" Class="header-title">
						<RadzenIcon Icon="psychology" Class="me-2" />
						@(IsEditMode ? "Questionnaire Editor" : "Questionnaire Builder")
					</RadzenText>
				</div>

				<div class="status-info-section">
					@{
						var status = IsEditMode ? Status : TemplateStatus.Draft;
						var statusText = IsEditMode ? TemplateStatusHelper.GetStatusText(Status) : "NEW";
						var statusIcon = IsEditMode ? TemplateStatusHelper.GetStatusIcon(Status) : "add_circle";
						var statusColorClass = GetEnhancedStatusClass(status);
					}
					<div class="status-badge-enhanced @statusColorClass">
						<RadzenIcon Icon="@statusIcon" Class="status-icon" />
						<span class="status-text">@statusText</span>
					</div>

					<div class="save-status-section">
						@if (LastSavedTime.HasValue && !IsSaving)
						{
							<div class="save-indicator saved">
								<RadzenIcon Icon="cloud_done" Class="save-icon" />
								<span class="save-text">Last saved @LastSavedTime.Value.ToString("HH:mm")</span>
							</div>
						}
						@if (IsSaving)
						{
							<div class="save-indicator saving">
								<RadzenIcon Icon="sync" Class="save-icon rotating-icon" />
								<span class="save-text">Saving...</span>
							</div>
						}
					</div>
				</div>
			</div>

				<div class="action-buttons-group">
					@{
						var currentStatus = IsEditMode ? Status : TemplateStatus.Draft;
					}
					@switch (currentStatus)
					{
						case TemplateStatus.Draft:
							<div class="button-group primary-actions">
								<StandardizedButton Action="StandardizedButton.ButtonAction.Save" ProcessingText="Saving" Click="@OnSave" Disabled="@IsSaving" Title="Save the questionnaire draft" />
								<StandardizedButton Action="StandardizedButton.ButtonAction.Publish" ProcessingText="Publishing" Click="@OnPublish" Disabled="@IsSaving" Title="Publish the questionnaire to make it available for use" />
							</div>
							<div class="button-group secondary-actions">
								<StandardizedButton Action="StandardizedButton.ButtonAction.Clone" Click="@OnClone" Disabled="@IsSaving" Title="Create a copy of this questionnaire" />
								<StandardizedButton Action="StandardizedButton.ButtonAction.Archive" ProcessingText="Archiving" Click="@OnArchive" Disabled="@IsSaving" Title="Archive this questionnaire" />
							</div>
							break;
						case TemplateStatus.Published:
							<div class="button-group primary-actions">
								<StandardizedButton Action="StandardizedButton.ButtonAction.Clone" ProcessingText="Cloning" Click="@OnClone" Title="Create a copy of this questionnaire" />
								<StandardizedButton Action="StandardizedButton.ButtonAction.Unpublish" ProcessingText="Unpublishing" Click="@OnUnpublish" Title="Unpublish the questionnaire to make it unavailable" />
							</div>
							<div class="button-group secondary-actions">
								<StandardizedButton Action="StandardizedButton.ButtonAction.Archive" ProcessingText="Archiving" Click="@OnArchive" Title="Archive this questionnaire" />
							</div>
							break;
						case TemplateStatus.Archived:
							<div class="button-group primary-actions">
								<StandardizedButton Action="StandardizedButton.ButtonAction.Clone" ProcessingText="Cloning" Click="@OnClone" Title="Create a copy of this questionnaire" />
								<StandardizedButton Action="StandardizedButton.ButtonAction.Restore" ProcessingText="Restoring" Click="@OnRestore" Title="Restore this archived questionnaire to draft status" />
							</div>
							break;
					}
				</div>
			</div>
		</div>
	</div>

<style>
	/* Enhanced Modern Header Styling */
	.questionnaire-header-modern {
		background: linear-gradient(135deg, #1e40af 0%, #3730a3 100%);
		box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
		border-bottom: 3px solid rgba(255, 255, 255, 0.1);
		position: relative;
		overflow: hidden;
	}

	.questionnaire-header-modern::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
		pointer-events: none;
	}

	.header-content {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1.5rem 0;
		position: relative;
		z-index: 1;
	}

	.header-left {
		display: flex;
		align-items: center;
		gap: 2rem;
		flex: 1;
	}

	.title-section {
		display: flex;
		align-items: center;
	}

	.header-title {
		color: white !important;
		font-weight: 700 !important;
		font-size: 1.75rem !important;
		margin: 0 !important;
		text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		display: flex;
		align-items: center;
	}

	.status-info-section {
		display: flex;
		align-items: center;
		gap: 1.5rem;
	}

	.status-badge-enhanced {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.75rem 1.25rem;
		border-radius: 25px;
		font-weight: 600;
		font-size: 0.875rem;
		text-transform: uppercase;
		letter-spacing: 0.5px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
		backdrop-filter: blur(10px);
		border: 1px solid rgba(255, 255, 255, 0.2);
		transition: all 0.3s ease;
	}

	.status-badge-enhanced:hover {
		transform: translateY(-1px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
	}

	.status-badge-enhanced.draft {
		background: linear-gradient(135deg, #f59e0b, #d97706);
		color: white;
	}

	.status-badge-enhanced.published {
		background: linear-gradient(135deg, #10b981, #059669);
		color: white;
	}

	.status-badge-enhanced.archived {
		background: linear-gradient(135deg, #6b7280, #4b5563);
		color: white;
	}

	.status-badge-enhanced.new {
		background: linear-gradient(135deg, #3b82f6, #1d4ed8);
		color: white;
	}

	.status-icon {
		font-size: 1rem;
	}

	.status-text {
		font-weight: 600;
	}

	.save-status-section {
		display: flex;
		align-items: center;
	}

	.save-indicator {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 1rem;
		border-radius: 20px;
		font-size: 0.875rem;
		backdrop-filter: blur(10px);
		border: 1px solid rgba(255, 255, 255, 0.15);
	}

	.save-indicator.saved {
		background: rgba(34, 197, 94, 0.2);
		color: #86efac;
	}

	.save-indicator.saving {
		background: rgba(96, 165, 250, 0.2);
		color: #93c5fd;
	}

	.save-icon {
		font-size: 1rem;
	}

	.save-text {
		font-weight: 500;
	}

	.action-buttons-group {
		display: flex;
		align-items: center;
		gap: 1rem;
	}

	.button-group {
		display: flex;
		gap: 0.75rem;
	}

	.button-group.primary-actions {
		border-right: 1px solid rgba(255, 255, 255, 0.2);
		padding-right: 1rem;
	}

	.button-group.secondary-actions {
		opacity: 0.9;
	}

	/* Animation */
	.rotating-icon {
		animation: rotate 2s linear infinite;
	}

	@@keyframes rotate {
		from {
			transform: rotate(0deg);
		}
		to {
			transform: rotate(360deg);
		}
	}

	/* Responsive Design */
	@@media (max-width: 1024px) {
		.header-left {
			gap: 1rem;
		}

		.action-buttons-group {
			gap: 0.5rem;
		}

		.button-group {
			gap: 0.5rem;
		}
	}

	@@media (max-width: 768px) {
		.header-content {
			flex-direction: column;
			gap: 1.5rem;
			align-items: stretch;
		}

		.header-left {
			flex-direction: column;
			gap: 1rem;
			align-items: center;
		}

		.status-info-section {
			flex-direction: column;
			gap: 1rem;
			align-items: center;
		}

		.action-buttons-group {
			justify-content: center;
			flex-wrap: wrap;
		}

		.button-group.primary-actions {
			border-right: none;
			padding-right: 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.2);
			padding-bottom: 0.75rem;
		}

		.header-title {
			font-size: 1.5rem !important;
		}
	}
</style>

@code {
	[Parameter] public bool IsEditMode { get; set; }
	[Parameter] public TemplateStatus Status { get; set; }
	[Parameter] public bool IsSaving { get; set; }
	[Parameter] public DateTime? LastSavedTime { get; set; }

	[Parameter] public EventCallback OnSave { get; set; }
	[Parameter] public EventCallback OnPublish { get; set; }
	[Parameter] public EventCallback OnArchive { get; set; }
	[Parameter] public EventCallback OnUnpublish { get; set; }
	[Parameter] public EventCallback OnRestore { get; set; }
	[Parameter] public EventCallback OnClone { get; set; }

	private string GetEnhancedStatusClass(TemplateStatus status)
	{
		return status switch
		{
			TemplateStatus.Draft => "draft",
			TemplateStatus.Published => "published",
			TemplateStatus.Archived => "archived",
			_ => "new"
		};
	}
}
